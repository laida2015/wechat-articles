# 微信公众号文章知识库系统 - 需求文档

## 项目背景
用户日常在微信中浏览公众号文章，希望能够：
1. 随手转发文章到微信读书或自己
2. 系统自动获取并保存文章
3. 将文章内容转化为结构化知识库
4. 用于追踪学术前沿、了解工具资讯

## 核心使用场景
```
用户在微信看到文章 
  → 转发到微信读书/文件传输助手 
  → 系统自动抓取文章 
  → AI提取关键信息 
  → 存入知识库（论文/工具/资讯分类）
  → 可视化展示和检索
```

## 功能需求

### 1. 数据获取层（优先级：P0）
- **方案选择**：基于微信读书 + wewe-rss
  - 使用 wewe-rss 订阅公众号，自动获取历史文章
  - 支持手动添加文章链接（兜底方案）
  - 定时同步新文章

- **核心功能**：
  - 添加/管理公众号订阅
  - 自动抓取文章内容（标题、正文、图片、发布时间）
  - 文章去重
  - 支持批量导入

### 2. 内容管理层（优先级：P0）
- 文章列表展示
  - 按公众号分组
  - 按时间排序
  - 搜索功能
- 文章详情阅读
  - 原文展示
  - 收藏/标记
  - 标签管理
- 分类系统
  - 学术论文
  - 工具资讯
  - 行业动态
  - 其他

### 3. 知识提取层（优先级：P1）
- AI 自动分析
  - 文章摘要生成
  - 关键信息提取
  - 自动分类（论文/工具/资讯）
  - 实体识别（论文名、工具名、作者等）
- 知识结构化
  - 论文信息提取（标题、作者、期刊、DOI）
  - 工具信息提取（名称、功能、链接）
  - 资讯信息提取（事件、时间、影响）

### 4. 知识库层（优先级：P1）
- 结构化存储
  - 论文追踪库
  - 工具库
  - 资讯库
- 关联功能
  - 相关文章推荐
  - 主题聚类
  - 知识图谱
- 导出功能
  - Markdown 导出
  - PDF 导出
  - 数据备份

## 技术方案

### 架构设计
```
前端 (Web UI)
    ↓
后端 API (FastAPI)
    ↓
├─ 数据获取模块 (wewe-rss + 爬虫)
├─ 数据存储模块 (PostgreSQL)
├─ AI 分析模块 (OpenAI API / 本地模型)
└─ 知识管理模块
```

### 技术栈
- **后端**: Python + FastAPI
- **前端**: Vue 3 + TypeScript + Vite
- **数据库**: PostgreSQL (或 SQLite 开发阶段)
- **AI**: OpenAI API (GPT-4) / 本地模型
- **RSS服务**: wewe-rss (Docker 部署)
- **爬虫**: requests + BeautifulSoup4
- **任务队列**: Celery + Redis (可选，用于异步任务)

### 数据模型

#### 公众号表 (accounts)
- id
- name (公众号名称)
- weread_id (微信读书ID)
- avatar (头像)
- description (简介)
- created_at
- updated_at

#### 文章表 (articles)
- id
- account_id (外键)
- title
- content (HTML)
- content_text (纯文本)
- url (原文链接)
- published_at
- fetched_at
- is_favorite (是否收藏)
- category (分类: paper/tool/news/other)
- tags (标签，JSON)
- created_at

#### AI分析结果表 (article_analysis)
- id
- article_id (外键)
- summary (摘要)
- keywords (关键词，JSON)
- entities (实体，JSON)
- category_confidence (分类置信度)
- paper_info (论文信息，JSON)
- tool_info (工具信息，JSON)
- news_info (资讯信息，JSON)
- created_at

#### 知识库表 (knowledge_base)
- id
- type (paper/tool/news)
- title
- content (结构化内容，JSON)
- source_articles (来源文章ID列表，JSON)
- created_at
- updated_at

## 实施计划

### Phase 1: MVP (最小可行产品) - 2天
**目标**: 能用起来的基础版本

1. **Day 1 上午**: 环境搭建
   - 部署 wewe-rss (Docker)
   - 搭建后端框架 (FastAPI)
   - 搭建前端框架 (Vue 3)
   - 数据库设计和初始化

2. **Day 1 下午**: 核心功能开发
   - 公众号订阅管理
   - 文章列表展示
   - 文章详情页面
   - 基础的收藏功能

3. **Day 2 上午**: AI 集成
   - 接入 OpenAI API
   - 实现文章摘要生成
   - 实现自动分类

4. **Day 2 下午**: 测试和优化
   - 功能测试
   - 界面优化
   - 部署文档

### Phase 2: 增强功能 - 后续迭代
- 知识图谱可视化
- 高级搜索和过滤
- 批量操作
- 数据导出
- 移动端适配

## 关键技术点

### 1. wewe-rss 集成
- 使用 Docker Compose 部署
- 通过 API 获取订阅源
- 定时任务同步文章

### 2. 文章内容提取
- 解析 RSS feed
- 提取 HTML 内容
- 图片本地化存储
- 文本清洗

### 3. AI 分析
- Prompt 工程设计
- 结构化输出（JSON）
- 批量处理优化
- 成本控制

### 4. 前端交互
- 响应式设计
- 虚拟滚动（大列表优化）
- 富文本展示
- 快捷键支持

## 风险和挑战

1. **微信读书账号封控**
   - 解决方案：多账号轮换，控制请求频率
   
2. **AI API 成本**
   - 解决方案：缓存结果，批量处理，可选本地模型

3. **文章内容版权**
   - 解决方案：仅个人使用，不公开分享

4. **数据量增长**
   - 解决方案：定期归档，数据库优化

## 成功标准

MVP 阶段：
- ✅ 能够订阅至少 5 个公众号
- ✅ 能够自动获取和展示文章
- ✅ 能够查看文章详情和收藏
- ✅ AI 能够生成摘要和分类
- ✅ 界面友好，操作流畅

完整版本：
- ✅ 支持 50+ 公众号订阅
- ✅ 知识库结构化管理
- ✅ 高级搜索和过滤
- ✅ 数据导出功能
- ✅ 移动端支持
